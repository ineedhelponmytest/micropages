<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MicroPages â€” Feed & Editor</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0f1115;color:#e6eef7;}
  header{padding:12px;background:#10121a;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;}
  button{padding:6px 12px;border:none;border-radius:4px;background:#24c77b;color:#0b0c0f;cursor:pointer;}
  .screen{display:none;height:calc(100vh - 48px);overflow:auto;padding:12px;}
  .active{display:block;}
  .page{background:#0b0c0f;padding:8px;margin:8px 0;border-radius:6px;border:1px solid #222;}
  .page-title{font-weight:bold;margin:0;}
  .page-content{margin:4px 0;}
  .small{font-size:12px;color:#9aa3b2;}
  textarea, input{width:100%;margin:4px 0;padding:6px;background:#0f1115;border:1px solid #222;color:#e6eef7;border-radius:4px;font-family:monospace;}
  .fullscreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#0f1115;color:#e6eef7;z-index:1000;overflow:auto;padding:12px;display:none;flex-direction:column;}
  .fullscreen button{align-self:flex-end;}
</style>
</head>
<body>

<header>
  <h1>MicroPages</h1>
  <div>
    <button id="homeBtn">Home</button>
    <button id="editorBtn">Create Page</button>
  </div>
</header>

<!-- Screens -->
<div id="feedScreen" class="screen active">
  <h2>Feed</h2>
  <div id="feedList"></div>
</div>

<div id="editorScreen" class="screen">
  <h2>Create Page</h2>
  <input type="text" id="title" placeholder="Page Title">
  <textarea id="htmlContent" rows="12" placeholder="Enter HTML here"></textarea>
  <button id="createBtn">Create Page</button>
</div>

<!-- Fullscreen View -->
<div class="fullscreen" id="fullscreenView">
  <button id="closeFullscreen">Back to Feed</button>
  <div id="fullscreenContent"></div>
</div>

<!-- Supabase UMD -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

<script>
  const SUPABASE_URL = 'https://jzeoinetgtxfrulujraa.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6ZW9pbmV0Z3R4ZnJ1bHVqcmFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0MTcxNzAsImV4cCI6MjA4MDk5MzE3MH0.Z0By2zuzpCWqNbH0YIT0vliseXFe1LlRSHsT2dSu4Hs';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // DOM Elements
  const homeBtn = document.getElementById('homeBtn');
  const editorBtn = document.getElementById('editorBtn');
  const feedScreen = document.getElementById('feedScreen');
  const editorScreen = document.getElementById('editorScreen');
  const feedList = document.getElementById('feedList');
  const titleInput = document.getElementById('title');
  const htmlContent = document.getElementById('htmlContent');
  const createBtn = document.getElementById('createBtn');
  const fullscreenView = document.getElementById('fullscreenView');
  const fullscreenContent = document.getElementById('fullscreenContent');
  const closeFullscreen = document.getElementById('closeFullscreen');

  // Screen switching
  homeBtn.onclick = ()=>{ feedScreen.classList.add('active'); editorScreen.classList.remove('active'); };
  editorBtn.onclick = ()=>{ feedScreen.classList.remove('active'); editorScreen.classList.add('active'); };

  // Load feed
  async function loadFeed(){
    const { data, error } = await supabase.from('pages').select('*').order('created_at',{ascending:false});
    if(error){ console.error('Supabase Error:', error); return; }
    feedList.innerHTML = '';
    data.forEach(page=>{
      const div = document.createElement('div');
      div.className = 'page';
      div.innerHTML = `
        <p class="page-title">${page.title||'Untitled'}</p>
        <div class="page-content">${page.content?.html||''}</div>
        <div style="display:flex;gap:4px;margin-top:4px;">
          <button class="viewBtn">View</button>
          <button class="remixBtn">Remix</button>
          <button class="likeBtn">Like (${page.likes||0})</button>
        </div>
        <p class="small">${new Date(page.created_at).toLocaleString()}</p>
      `;
      // View button
      div.querySelector('.viewBtn').onclick = ()=>{
        fullscreenContent.innerHTML = `<h2>${page.title}</h2>${page.content?.html||''}`;
        fullscreenView.style.display = 'flex';
      };
      // Remix button
      div.querySelector('.remixBtn').onclick = ()=>{
        editorBtn.click();
        titleInput.value = page.title + ' (Remix)';
        htmlContent.value = page.content?.html||'';
      };
      // Like button
      div.querySelector('.likeBtn').onclick = async ()=>{
        const { error } = await supabase.from('pages').update({likes: (page.likes||0)+1}).eq('id', page.id);
        if(error){ console.error('Supabase Like Error:', error); return; }
        loadFeed();
      };
      feedList.appendChild(div);
    });
  }

  // Close fullscreen
  closeFullscreen.onclick = ()=>{ fullscreenView.style.display='none'; };

  // Create page
  createBtn.onclick = async ()=>{
    if(!titleInput.value){ alert('Enter a title'); return; }
    if(!htmlContent.value){ alert('Enter HTML content'); return; }
    const { data, error } = await supabase.from('pages').insert([{
      title: titleInput.value,
      content: { html: htmlContent.value },
      likes:0
    }]);
    if(error){ alert('Supabase Create Error: ' + error.message); return; }
    titleInput.value='';
    htmlContent.value='';
    homeBtn.click();
    loadFeed();
  };

  // Initialize
  loadFeed();
</script>
</body>
</html>
